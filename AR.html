<!DOCTYPE html>  
<html lang="zh">  
<head>  
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">  
    <title>AR.js Example</title>  
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>  
    <script src="https://cdn.jsdelivr.net/npm/@ar-js-org/ar.js@latest/aframe/build/aframe-ar.js"></script>  
    <style>  
        body {   
            margin: 0;   
            overflow: hidden;   
            font-family: Arial, sans-serif;  
        }  
        #camera-permission {  
            position: fixed;  
            top: 0;  
            left: 0;  
            width: 100%;  
            background: rgba(0,0,0,0.7);  
            color: white;  
            text-align: center;  
            padding: 10px;  
            z-index: 1000;  
        }  
    </style>  
</head>  
<body>  
    <div id="camera-permission" style="display:none;">  
        请允许摄像头访问  
    </div>  

    <a-scene   
        renderer="logarithmicDepthBuffer: true;"   
        embedded   
        arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;"  
    >  
        <!-- 使用Hiro标记 -->  
        <a-marker preset="hiro">  
            <!-- 3D模型 -->  
            <a-entity   
                position="0 0 0"  
                rotation="0 0 0"  
                scale="0.05 0.05 0.05"  
                gltf-model="https://raw.githubusercontent.com/nnnnakosuki/AR/refs/heads/main/assets/models/cute_spooky_cat_gltf/scene.gltf"  
            >  
            </a-entity>  
        </a-marker>  

        <!-- 摄像头 -->  
        <a-entity camera></a-entity>  
    </a-scene>  

    <script>  
        // 检查并请求摄像头权限  
        function requestCameraPermission() {  
            const permissionDiv = document.getElementById('camera-permission');  
            
            // 首先检查是否已经有摄像头权限  
            navigator.mediaDevices.getUserMedia({ video: true })  
                .then(function(stream) {  
                    // 成功获取摄像头  
                    permissionDiv.style.display = 'none';  
                    stream.getTracks().forEach(track => track.stop());  
                })  
                .catch(function(err) {  
                    // 显示权限提示  
                    permissionDiv.style.display = 'block';  
                    console.error('摄像头权限错误:', err);  
                });  
        }  

        // 页面加载时请求摄像头权限  
        window.addEventListener('load', requestCameraPermission);  

        // 手势控制组件  
        AFRAME.registerComponent('gesture-handler', {  
            schema: {  
                enabled: { default: true }  
            },  
            init: function () {  
                this.scale = 1;  
                this.initialScale = 1;  
                this.lastRotationY = 0;  

                // 缩放事件  
                this.el.addEventListener('pinchstart', (evt) => {  
                    this.initialScale = this.scale;  
                });  

                this.el.addEventListener('pinchmove', (evt) => {  
                    this.scale = this.initialScale * evt.detail.scale;  
                    this.el.setAttribute('scale', {   
                        x: this.scale * 0.05,   
                        y: this.scale * 0.05,   
                        z: this.scale * 0.05   
                    });  
                });  

                // 旋转事件  
                this.el.addEventListener('touchmove', (evt) => {  
                    if (evt.touches.length === 1) {  
                        const touch = evt.touches[0];  
                        const deltaX = touch.clientX - (window.innerWidth / 2);  
                        this.lastRotationY += deltaX * 0.5;  
                        this.el.setAttribute('rotation', {   
                            x: 0,   
                            y: this.lastRotationY,   
                            z: 0   
                        });  
                    }  
                });  
            }  
        });  

        // 将手势控制添加到模型  
        document.querySelector('a-entity[gltf-model]').setAttribute('gesture-handler', '');  
    </script>  
</body>  
</html>